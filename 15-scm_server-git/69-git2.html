<meta http-equiv="content-type" content="text/html;charset=utf-8" />


<h1>Správa linuxového serveru: Pokročilejší nasazení Gitu</h1>

<p>Minulý díl se věnoval představení SCM nástroje Git a vytvoření centrálního úložiště na vlastním serveru. Řešení představené minule bylo to nejjednodušší možné. V tomto dílu zmíním jeden tip pro efektivnější používání Gitu, dále vám ukážu, jak repozitáře zveřejnit pro read-only přístup, a nakonec vám povím, jak obsah repozitářů prohlížet přes webové rozhraní.</p>

<h3>Úvod</h3>
<p>Pokud přicházíte poprvé k problematice SCM nástrojů, tedy nástrojů pro správu verzí, měli byste si nejprve přečíst <a href="http://www.linuxexpres.cz/praxe/sprava-linuxoveho-serveru-git-na-vlastnim-serveru">minulý</a> díl, kde byl Git představen.</p>
<h3>Základy práce s Gitem: Ignorování souborů</h3>
<p>Git není navržen k verzování jednoho jediného souboru. Verzuje se vždy celý adresář a o veškerých souborech, které v něm existují, ale nejsou verzovány, dostanete hlášení po každém „git status“:</p>
<pre># On branch master
# Changed but not updated:
#   (use "git add ..." to update what will be committed)
#   (use "git checkout -- ..." to discard changes in working directory)
#
#       modified:   prace.txt
#
# Untracked files:
#   (use "git add ..." to include in what will be committed)
#
#       prace.txt~
no changes added to commit (use "git add" and/or "git commit -a")</pre>
<p>Tyto soubory mohou představovat dočasné soubory, záložní kopie editoru (jako <code>prace.txt~</code> v příkladu výše), logy, zkrátka vše, co sice v adresáři zůstane, ale v repozitáři to nechcete. Abyste udržovali výpis čistý a přehledný, je vhodné Gitu říci, které typy souborů má ignorovat. Ty se pak ve výpisu změn nebudou zobrazovat</p>
<p>Řešení jsou dvě. Obě zahrnují soubor s definicí vzorů jmen souborů, které se mají ignorovat, např.:</p>
<pre>*~
*.pdf
!zachovat.pdf
*.aux
*.[ab]</pre>
<p>Příklad obsahu souboru by měl být samovysvětlující. Nebudou se brát v úvahu soubory se jmény končící na <code>~</code>, dále všechny PDF soubory s výjimkou souboru <code>zachovat.pdf</code>, který ignorován nebude, dále všechny soubory <code>.aux</code> a všechny soubory s příponami <code>.a</code> nebo <code>.b</code>.</p>
<p>Tento soubor je třeba vhodně pojmenovat a umístit. Pokud chcete, aby byl součástí repozitáře (a verzoval se taky), vytvořte v příslušném adresáři soubor <code>.gitignore</code>. Chcete-li tyto vzory držet mimo repozitář, využijte soubor <code>.git/info/exclude</code> (cesta je relativní ke kořenovému adresáři repozitáře).</p>
<h3>Veřejný read-only přístup k repozitáři pomocí Git démona</h3>
<p>Jednou z možností, jak zpřístupnit veřejnosti Git repozitář pro read-only přístup (tedy pro klonování repozitáře a běžnou synchronizaci, nikoliv však pro zápis), je využít samotného Git démona a přistupovat k repozitáři prostřednictvím Git protokolu. V Debianu je třeba za tímto účelem nainstalovat balíček <code>git-daemon</code>:</p>
<pre>aptitude install git-daemon</pre>
<p>Git démon v Debianu pracuje s repozitáři umístěnými ve <code>/var/cache/git</code>, kde je samozřejmě nejspíše nemáte. Je tedy třeba si dopomoci symbolickými odkazy. Dávám zde k dispozici dva příklady podle typu umístění repozitáře, vyberte si ten, který odpovídá vašemu repozitáři:</p>
<pre>ln -s /cesta/k/repositar/.git /var/cache/git/repositar.git
ln -s /cesta/k/repositar.git /var/cache/git/repositar.git</pre>
<p>Pokud se v tuto chvíli pokusíte repozitář naklonovat, obdržíte suchou chybovou hlášku:</p>
<pre>fatal: The remote end hung up unexpectedly</pre>
<p>Kdybyste někdy řešili problém, proč se toto děje, podívejte se na server do <code>/var/log/git-daemon/current</code>, dozvíte se konkrétní příčinu. V tomto případě ohlásí Git chybu „repository not exported“, což znamená, že danému repozitáři nebyl povolen export Git démonem. Proto je třeba ještě vytvořit následující soubor, kterým export povolíte:</p>
<pre>touch /var/cache/git/repositar.git/git-daemon-export-ok</pre>
<p>Repozitář pak můžete naklonovat tímto způsobem:</p>
<pre>git clone git://server.example.org/repo.git</pre>
<h3>Prohlížení Git repozitáře online pomocí nástroje Gitweb</h3>
<p>Gitweb je nástroj pro prohlížení Git repozitářů prostřednictvím webového prohlížeče. Můžete si procházet historii, stahovat snapshoty, prohlížet změny atd., a samozřejmě to také umožnit návštěvníkům vašeho webu. Nástroj si můžete prohlédnout v akci na <a href="http://git.kernel.org/?p=linux/kernel/git/next/linux-next.git;a=summary">git.kernel.org</a>, na některém z repozitářů obsahujícím linuxové jádro.</p>
<p>Instalace Gitwebu je poměrně jednoduchá, stačí nainstalovat příslušný balíček:</p>
<pre>aptitude install gitweb</pre>
<p>Máte-li nainstalovaný webový server Apache, Gitweb by měl začít fungovat okamžitě – vytvoří se alias <code>/gitweb</code>, tudíž zadejte URL následujícího typu: <code>http://server.example.org/gitweb</code>. Konfiguraci Gitwebu naleznete v <code>/etc/apache2/conf.d/gitweb</code>. Pokud tedy chcete změnit daný alias nebo si Gitweb zpřístupnit jen na určitém virtuálním serveru (virtual host), soubor upravte nebo přesuňte jinam a jeho obsah vložte tam, kde ho mít chcete. Připomínám, že webovému serveru Apache jsem se v tomto seriálu již věnoval, a sice ve třech dílech (v <a href="http://www.linuxexpres.cz/praxe/sprava-linuxoveho-serveru-uvod-do-konfigurace-apache">prvním</a>, <a href="http://www.linuxexpres.cz/praxe/sprava-linuxoveho-serveru-uvod-do-konfigurace-apache-1">druhém</a> a <a href="http://www.linuxexpres.cz/praxe/sprava-linuxoveho-serveru-uvod-do-konfigurace-apache-moduly">třetím</a>).</p>
<p>Používáte-li jiný webový server, budete muset upravit jeho nastavení pro Gitweb. Aplikaci Gitweb naleznete v <code>/usr/share/gitweb</code>, je napsaná v Perlu a patrně budete využívat CGI nebo FastCGI. Návod pro zprovoznění Gitwebu pomocí webového serveru Nginx naleznete v odkazech pod článkem.</p>
<p>Gitweb má konfigurační soubor umístěný v <code>/etc/gitweb.conf</code>, je poměrně strohý, ale přesto obsahuje pár věcí, které můžete chtít změnit, jako logo, odkaz na každé stránce (vedoucí třeba zpět na váš web) atd.</p>
<p>Pokud jste svoje repozitáře nepojmenovali, asi vás příliš neuspokojí pohled na popisek „<em>Unnamed repository; edit this file 'description' to name the repository.“</em>, zde stačí udělat přesně to, co popisek říká, upravit soubor <code>.git/description</code> v daném repozitáři.</p>
<p>Musím vás upozornit ještě na jednu věc. Zatímco Git démon vyžaduje výše zmíněný <code>git-daemon-export-ok</code>, Gitweb zpřístupní vše, co se nachází v nastaveném adresáři (výchozí je <code>/var/cache/git</code>), bez ohledu na tuto značku. Chcete-li upravit, které repozitáře bude Gitweb zpřístupňovat a které ne, máte dvě možnosti. Buď v <code>/etc/gitweb.conf</code> změníte proměnnou <code>$projectroot</code> na nějaký jiný adresář, a do něj vložíte příslušné symbolické odkazy těch repozitářů, které zveřejnit chcete. Nebo vytvoříte seznam projektů, což je soubor obsahující položky ve formátu <code>cesta_k_projektu <span class="eaddress">vlastnik@example<img src="http://www.linuxexpres.cz/modules/marwel/images/tecka.gif" alt="_" />com</span></code> a cestu k tomuto souboru vložíte jako hodnotu proměnné <code>$projects_list</code> v <code>/etc/gitweb.conf</code>, takto:</p>
<pre>$projects_list = "/var/cache/git/projekty.txt";</pre>
<p>Soubor s projekty (repozitáři) může mít následující obsah:</p>
<pre>repositar1.git <span class="eaddress">vlastnik1@example<img src="http://www.linuxexpres.cz/modules/marwel/images/tecka.gif" alt="_" />org</span>
repositar2.git <span class="eaddress">vlastnik2@example<img src="http://www.linuxexpres.cz/modules/marwel/images/tecka.gif" alt="_" />org</span></pre>
<p>Cesta k repozitářům může být relativní nebo absolutní, v příkladu výše je cesta relativní (resp. cesta vypadá neuvedená, jelikož soubor se seznamem projektů je ve stejném adresáři jako repozitáře).</p>
<p>Tím bych tento díl ukončil. Příště vám představím řešení centrálního repozitáře s jemnějším systémem oprávnění než „plný přístup nebo žádný přístup“, které bylo prezentováno v minulém díle.</p>

<pre id="links">http://gitready.com/beginner/2009/01/19/ignoring-files.html Ignoring files
http://www.frlinux.eu/?p=135 gitweb and nginx on Debian
http://git-scm.com/ Web projektu s odkazy na dokumentaci a videa o Gitu
http://knihy.nic.cz/ Scott Chacon, CZ.NIC: Pro Git (kniha o Gitu přeložená do češtiny)
http://book.git-scm.com/ The Git Community Book</pre>
