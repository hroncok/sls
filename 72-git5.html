<meta http-equiv="content-type" content="text/html;charset=utf-8" />


<h1>Správa linuxového serveru: Git hooky a alternativy ke Githubu</h1>

<p>V tomto dílu bude problematika Gitu uzavřena. Budou představeny Git hooky, tedy možnost skriptování navázaného na události v Git repozitáři a alternativy ke Githubu, které můžete nasadit na svůj server.</p>

<h3>Git hooky</h3>
<p>Git obsahuje jednu velmi podstatnou vlastnost, která se dá velmi dobře využít na serveru. Pokud jste třeba někdy zabrousili do vod frameworku Ruby on Rails, určitě jste slyšeli o hostingu Heroku, kde se nasazení (deployment) aplikací řeší právě přes Git. Je jistě velmi pohodlné provést aktualizaci webové aplikace na serveru prostřednictvím obyčejného <code>git push</code>. Takovou funkcionalitu je možné realizovat právě pomocí Git „háčků“.</p>
<p>Git hook je obyčejný shellový skript, který je umístěn v podadresáři <code>hooks</code> v adresáři obsahujícím Git repozitář (obvykle <code>.git/hooks</code>). Git tyto hooky spouští v reakci na jisté události, resp. v konkrétním okamžiku (před či po nějaké operaci). To, zda bude skript spuštěn, nebo ne, je dáno jeho oprávněním (je-li spustitelný, bude spuštěn). Ke tvorbě skriptu můžete využít jakéhokoliv skriptovacího jazyka, nebo zůstat u Bashe (popř. jiného oblíbeného shellového interpretu).</p>
<p>Seznam jednotlivých hooků i s jejich případnými parametry a činností, na kterou je příslušný hook, naleznete v tabulce níže:</p>
<table>
<tbody>
<tr><th>
<p>Název skriptu</p>
</th><th>
<p>Vázáno na</p>
</th><th>
<p>Parametry</p>
</th></tr>
<tr>
<td>
<p><code>applypatch-msg</code></p>
</td>
<td>
<p>běh <code>git-am</code> skriptu</p>
</td>
<td>
<p>název souboru s popisem commitu</p>
</td>
</tr>
<tr>
<td>
<p><code>pre-applypatch</code></p>
</td>
<td>
<p>běh <code>git-am</code>, po aplikování patche a commitu</p>
</td>
<td>
<p>-</p>
</td>
</tr>
<tr>
<td>
<p><code>pre-commit</code></p>
</td>
<td>
<p>běh <code>git-commit</code> před commitem</p>
</td>
<td>
<p>-</p>
</td>
</tr>
<tr>
<td>
<p><code>prepare-commit-msg</code></p>
</td>
<td>
<p>běh <code>git-commit</code> ihned po připravení výchozího popisu commitu</p>
</td>
<td>
<p>1-3 parametry: jméno souboru s popisem commitu, zdroj zprávy (viz dokumentace), SHA1 commitu</p>
</td>
</tr>
<tr>
<td>
<p><code>commit-msg</code></p>
</td>
<td>
<p>běh <code>git-commit</code></p>
</td>
<td>
<p>název souboru s popisem commitu</p>
</td>
</tr>
<tr>
<td>
<p><code>post-commit</code></p>
</td>
<td>
<p>běh <code>git-commit</code> po provedení commitu</p>
</td>
<td>
<p>-</p>
</td>
</tr>
<tr>
<td>
<p><code>pre-rebase</code></p>
</td>
<td>
<p>běh <code>git-rebase</code> před prováděním rebase</p>
</td>
<td>
<p>-</p>
</td>
</tr>
<tr>
<td>
<p><code>post-checkout</code></p>
</td>
<td>
<p>běh <code>git-checkout</code> po aktualizaci pracovního stromu</p>
</td>
<td>
<p>3 parametry: ref předchozí HEAD, ref následující HEAD, druh checkoutu (viz dokumentace)</p>
</td>
</tr>
<tr>
<td>
<p><code>post-merge</code></p>
</td>
<td>
<p>běh <code>git-merge</code> po úspěšném provedení merge</p>
</td>
<td>
<p>typ merge (viz dokumentace)</p>
</td>
</tr>
<tr>
<td>
<p><code>pre-receive</code></p>
</td>
<td>
<p>běh <code>git-receive-pack</code> na serveru před prováděním aktualizace</p>
</td>
<td>
<p>žádné, ale přijímá vstup na STDIN (viz dokumentace)</p>
</td>
</tr>
<tr>
<td>
<p><code>update</code></p>
</td>
<td>
<p>běh <code>git-receive-pack</code> na serveru po aktualizaci dat, ale před aktualizací referencí</p>
</td>
<td>
<p>název reference, starý SHA1, nový SHA1</p>
</td>
</tr>
<tr>
<td>
<p><code>post-receive</code></p>
</td>
<td>
<p>běh <code>git-receive-pack</code> na serveru po aktualizaci referencí</p>
</td>
<td>
<p>žádné, ale přijímá vstup na STDIN (viz dokumentace)</p>
</td>
</tr>
<tr>
<td>
<p><code>post-update</code></p>
</td>
<td>
<p>běh <code>git-receive-pack</code> na serveru po aktualizaci referencí</p>
</td>
<td>
<p>proměnlivý počet, seznam aktualizovaných referencí</p>
</td>
</tr>
<tr>
<td>
<p><code>pre-auto-gc</code></p>
</td>
<td>
<p>běh <code>git-gc --auto</code>, před provedením operace</p>
</td>
<td>
<p>-</p>
</td>
</tr>
</tbody>
</table>
<p>Přehledovou tabulku doporučuji doplnit <a href="http://book.git-scm.com/5_git_hooks.html">dokumentací</a>. Stejně tak doporučuji si projít příklady skriptů, které by měly být součástí libovolného Git repozitáře. Naleznete tam nejenom příklady použití, ale také užitečné komentáře o použití daných háčků.</p>
<p>Stejně jako existují místní a vzdálené Git repozitáře, můžete specifikovat různé místní a vzdálené háčky. Můžete tedy používat jednu sadu funkcionality lokálně a jinou vzdáleně.</p>
<p>Jak je z přehledové tabulky asi patrné, jednotlivé háčky je možné použít pro ledacos. K výše zmíněné aktualizaci webové aplikace po provedení „push“ operace z místního repozitáře může posloužit háček <code>post-update</code>. K samotnému rozbalení obsahu repozitáře můžete použít třeba tento postup:</p>
<pre>git archive --format=tar HEAD | (cd /var/www/prezentace &amp;&amp; tar xf -)</pre>
<p>Na Git háčky je ale možné „pověsit“ i samotnou správu repozitářů, různé kontroly a pojistky. Ukončení skriptu jiným chybovým stavem než nulou (např. <code>exit 1</code>) má v některých případech za následek selhání dané operace. Můžete tak odmítat <code>push</code> na základě specifických kritérií.</p>
<h3>Alternativy ke Githubu</h3>
<p>Github je nepochybně velmi zdařilý projektový hosting. Není však jediným hostingem podporujícím Git. Ten podporuje i řada jiných, jako např. Sourceforge, Google code apod. To vše jsou však webové služby. Nejsou open source a není možné je nasadit na vlastní server. Máte možnost buď akceptovat jejich podmínky, nebo se poohlédnout po nějaké alternativě. K těmto projektům existuje několik alternativ.</p>
<h4>Girocco</h4>
<p><a href="http://repo.or.cz/w/girocco.git">Girocco</a> je Git hosting, který lze označit jako GitWeb na steroidech. Girocco je na Gitwebu založeno a ovládá se stejně. Obsahuje samozřejmě potřebné vlastnosti pro Git hosting, jako registraci uživatelů/projektů apod., a některé vlastnosti navíc. Autorem je Petr Baudiš a software je provozován na známém repozitáři <a href="http://repo.or.cz/">repo.or.cz</a>. Pro svou funkci potřebuje webový server, Git a GitWeb. Lze ho propojit s Git démonem. Podporuje zrcadlení repozitářů (můžete jej tedy používat jako záložní úložiště pro některé své repozitáře hostované jinde) a forkování projektů.</p>
<h4>Gitorious</h4>
<p><a href="https://gitorious.org/gitorious/">Gitorious</a> je založený na Ruby on Rails a šířený pod licencí GNU Affero GPL verze 3. Ta se liší od klasické GNU/GPL tím, že zdrojový kód je třeba zpřístupnit nejen příjemcům při distribuci softwaru, ale také při jeho zpřístupnění uživatelům přes síť. Gitorious je Web 2.0 aplikace ve stylu Githubu, je mu tedy o něco blíže než Girocco. Oproti GitWebu obsahuje navíc vestavěnou wiki, kterou je možné použít pro dokumentaci projektu.</p>
<p>Žádný z těchto projektů neobsahuje všechny funkce Githubu, jako např. komentování, bug tracker apod. Pokud takové funkce potřebujete, je možné zkombinovat některé z těchto řešení s jiným open-source projektem – kupříkladu, open-source bug trackerů existuje celá řada (Flyspray, Bugzilla, Mantis apod.). Jediné, co budete muset oželet, je integrace těchto nástrojů s Git hostingem.</p>
<h4>Redmine, Trac a ostatní</h4>
<p>Kromě Git hostingů existují také systémy pro správu (softwarových) projektů, které mohou mít rovněž podporu Gitu. Ta může zahrnovat jak prohlížení repozitářů, tak třeba integraci s bug trackerem. Vytvoření repozitáře a přístup (se zápisem) je obvykle nutné řešit jinak, nicméně tyto nástroje mohou obsahovat řadu užitečných komponent jako integrované wiki, bug trackery apod. Mezi tyto nástroje patří v tomto seriálu již zmiňovaný Redmine nebo např. Trac.</p>
<h3>Závěr</h3>
<p>Tím bych tento díl, stejně jako téma Git uzavřel. Na závěr nemohu nezmínit, že existuje řada jiných SCM nástrojů, kterým jsem se zde nevěnoval (např. Mercurial, Bazaar, SVN apod.). Řada z nich je open source a je možné (v případě centralizovaných SCM i nutné) je nasadit na server. Jsou opatřeny různými vlastnostmi a rozhodně bych doporučoval se na ně podívat.</p>

<pre id="links"></pre>
